# SkillForge MVP Plan

## Overview

SkillForge is an agentic framework where AI agents learn from YouTube tutorials and codify learnings into reusable Claude Code-style skills.

**MVP Scope:** Watch YouTube → Extract Knowledge → Write SKILL.md

---

## Tech Stack

- **AI SDK:** Vercel AI SDK 6 with `@ai-sdk/google`
- **Model:** Gemini 3 Flash
- **Framework:** Next.js 15 (App Router)
- **UI:** Tailwind CSS + shadcn/ui

---

## Gemini Built-in Tools

| Built-in Tool | AI SDK Usage | Purpose |
|---------------|--------------|---------|
| Google Search | `google.tools.googleSearch({})` | Find YouTube tutorials, docs |
| URL Context | `google.tools.urlContext({})` | Analyze YouTube videos directly |

---

## Directory Structure

```
skill-forge/
├── .forge/skills/                    # Generated skills storage
│   └── [skill-name]/SKILL.md
├── src/
│   ├── app/
│   │   ├── page.tsx                  # Landing/demo page
│   │   └── api/
│   │       └── agent/route.ts        # Streaming agent endpoint
│   ├── lib/
│   │   ├── agent/
│   │   │   └── forge-agent.ts        # ToolLoopAgent config
│   │   └── tools/
│   │       ├── shell.ts              # Shell executor
│   │       └── skill-commands.ts     # Skill command handlers
│   └── components/
│       └── ForgeDemo.tsx             # Main demo UI
└── package.json
```

---

## Custom Shell Commands

**Inspired by:** [notion-agent podcast commands](https://github.com/fyang0507/notion-agent/blob/main/src/skills/podcast/index.ts)

### Available Commands

| Command | Description |
|---------|-------------|
| `skill help` | Show available commands |
| `skill list` | List all skills (name + description) |
| `skill search <keyword>` | Fuzzy search skills by keyword |
| `skill get <name>` | Read full SKILL.md content |
| `skill set <name> "<content>"` | Write/update a skill |

### Command Handlers

```typescript
// src/lib/tools/skill-commands.ts
import fs from 'fs/promises';
import path from 'path';
import matter from 'gray-matter';
import Fuse from 'fuse.js';

const SKILLS_DIR = '.forge/skills';

export type CommandHandler = (args: string) => string | Promise<string>;

export function createSkillCommands(): Record<string, CommandHandler> {
  return {
    'skill help': () => `Available commands:
  skill list              - List all skills
  skill search <keyword>  - Search skills by keyword
  skill get <name>        - Read a skill
  skill set <name> "..."  - Write a skill`,

    'skill list': async () => {
      const skills = await scanSkills();
      if (skills.length === 0) return '(no skills found)';
      return skills.map(s => `- ${s.name}: ${s.description}`).join('\n');
    },

    'skill search': async (keyword) => {
      const skills = await scanSkills();
      const fuse = new Fuse(skills, { keys: ['name', 'description'], threshold: 0.4 });
      const results = fuse.search(keyword);
      if (results.length === 0) return `No skills matching "${keyword}"`;
      return results.map(r => `- ${r.item.name}: ${r.item.description}`).join('\n');
    },

    'skill get': async (name) => {
      const skillPath = path.join(SKILLS_DIR, name.trim(), 'SKILL.md');
      try {
        return await fs.readFile(skillPath, 'utf-8');
      } catch {
        return `Skill "${name}" not found`;
      }
    },

    'skill set': async (args) => {
      // Parse: skill set <name> "<content>"
      const match = args.match(/^(\S+)\s+"([\s\S]+)"$/);
      if (!match) return 'Usage: skill set <name> "<content>"';

      const [, name, content] = match;
      const skillDir = path.join(SKILLS_DIR, name);
      await fs.mkdir(skillDir, { recursive: true });
      await fs.writeFile(path.join(skillDir, 'SKILL.md'), content);
      return `Skill "${name}" saved to ${skillDir}/SKILL.md`;
    },
  };
}

async function scanSkills(): Promise<Array<{ name: string; description: string }>> {
  try {
    const dirs = await fs.readdir(SKILLS_DIR);
    const skills = [];

    for (const dir of dirs) {
      try {
        const content = await fs.readFile(path.join(SKILLS_DIR, dir, 'SKILL.md'), 'utf-8');
        const { data } = matter(content);
        if (data.name && data.description) {
          skills.push({ name: data.name, description: data.description });
        }
      } catch { /* skip */ }
    }

    return skills;
  } catch {
    return [];
  }
}
```

### Shell Executor

```typescript
// src/lib/tools/shell.ts
import { tool } from 'ai';
import { z } from 'zod';
import { createSkillCommands, CommandHandler } from './skill-commands';

export function createShellTool() {
  const commands = createSkillCommands();

  return tool({
    description: `Execute skill commands.

${commands['skill help']()}`,
    parameters: z.object({
      command: z.string().describe('Command to execute'),
    }),
    execute: async ({ command }) => {
      // Find matching command handler
      const sortedCommands = Object.keys(commands).sort((a, b) => b.length - a.length);

      for (const cmd of sortedCommands) {
        if (command === cmd || command.startsWith(cmd + ' ')) {
          const args = command.slice(cmd.length).trim();
          const handler = commands[cmd];
          return await handler(args);
        }
      }

      return `Unknown command. Run "skill help" for available commands.`;
    },
  });
}
```

---

## MVP Flow

```
User provides YouTube URL
        ↓
ToolLoopAgent (Gemini 3 Flash)
        ↓
skill list → (empty)
        ↓
url_context analyzes video
        ↓
Extracts key learnings
        ↓
skill set stripe-webhooks "---
name: stripe-webhooks
description: ...
---
# Content..."
        ↓
SKILL.md saved
```

---

## Agent Configuration

```typescript
import { ToolLoopAgent } from 'ai';
import { google } from '@ai-sdk/google';
import { createShellTool } from '@/lib/tools/shell';

const forgeAgent = new ToolLoopAgent({
  model: google('gemini-3-flash'),
  instructions: `You are SkillForge, an agent that learns from YouTube tutorials
and creates reusable skill files.

## Skill Commands

skill list              - List all skills
skill search <keyword>  - Search skills by keyword
skill get <name>        - Read a skill
skill set <name> "..."  - Write a skill

## Workflow

When given a YouTube URL:
1. Run "skill list" to check existing skills
2. Run "skill search <topic>" if relevant skills might exist
3. Use url_context to analyze the video
4. Extract key learnings, gotchas, best practices
5. Run "skill set <name> "<content>"" to save the skill

## Skill Format

Skills use YAML frontmatter:
---
name: skill-name
description: One-line description of when to use this skill
---
# Title
## Key Learnings
## Common Gotchas
## Working Pattern`,
  tools: {
    google_search: google.tools.googleSearch({}),
    url_context: google.tools.urlContext({}),
    shell: createShellTool(),
  },
});
```

---

## SKILL.md Format

```yaml
---
name: stripe-webhook-verification
description: Verify Stripe webhook signatures. Use when handling Stripe webhooks.
---

# Stripe Webhook Verification

## Key Learnings

1. **Never trust raw body parsing** - Use `express.raw()` middleware
2. **Signature header** - Look for `stripe-signature` header

## Common Gotchas

- Body must be raw buffer, NOT parsed JSON
- Clock skew tolerance defaults to 300 seconds

## Working Pattern

```javascript
const event = stripe.webhooks.constructEvent(req.body, sig, secret);
```
```

---

## Progressive Disclosure

```
Run 1 (No skills):
  Agent: skill list → (no skills found)
  Agent: skill search webhooks → No skills matching "webhooks"
  Agent: [analyzes YouTube]
  Agent: skill set stripe-webhooks "..."

Run 2 (Skill exists):
  Agent: skill list → stripe-webhooks: Verify Stripe webhook signatures...
  Agent: skill get stripe-webhooks → full content
  Agent: [uses knowledge, skips research]
```

---

## Implementation Phases

### Phase 1: Foundation
- [ ] Initialize Next.js 15 + TypeScript + Tailwind
- [ ] Install AI SDK 6 + @ai-sdk/google + gray-matter + fuse.js
- [ ] Create directory structure
- [ ] Set up environment variables

### Phase 2: Skill Commands
- [ ] Implement skill-commands.ts (list/search/get/set)
- [ ] Implement shell.ts executor
- [ ] Test all commands

### Phase 3: Core Agent
- [ ] Configure ToolLoopAgent with Gemini tools + shell
- [ ] Create /api/agent route
- [ ] Test: YouTube URL → SKILL.md

### Phase 4: Demo UI
- [ ] Create ForgeDemo component
- [ ] Show agent steps/reasoning
- [ ] Display generated skill files
- [ ] Run 1 vs Run 2 comparison

---

## Environment Variables

```env
GOOGLE_GENERATIVE_AI_API_KEY=   # Gemini API key
```

---

## Dependencies

```json
{
  "dependencies": {
    "ai": "^6.0.0",
    "@ai-sdk/google": "^1.0.0",
    "gray-matter": "^4.0.3",
    "fuse.js": "^7.0.0"
  }
}
```
